# æ›´æ–°è¯´æ˜ - å®¢æˆ·ç«¯æ¡æ‰‹å†³å®šå‹ç¼© v2.0

## ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**: 2.0
- **å‘å¸ƒæ—¥æœŸ**: 2026-02-15
- **ä¸»è¦å˜æ›´**: ä»æœåŠ¡ç«¯ç»Ÿä¸€é…ç½®æ”¹ä¸ºå®¢æˆ·ç«¯æ¡æ‰‹å†³å®šå‹ç¼©

## æ ¸å¿ƒæ”¹è¿›

### ä» v1.0 åˆ° v2.0 çš„å˜åŒ–

| ç‰¹æ€§ | v1.0 | v2.0 |
|------|------|------|
| å‹ç¼©é…ç½® | æœåŠ¡ç«¯å…¨å±€ç»Ÿä¸€ (`ENABLE_COMPRESSION`) | å®¢æˆ·ç«¯åœ¨æ¡æ‰‹æ—¶å†³å®š |
| é…ç½®çµæ´»æ€§ | ä½ï¼ˆæ‰€æœ‰å®¢æˆ·ç«¯ç›¸åŒï¼‰ | é«˜ï¼ˆæ¯ä¸ªå®¢æˆ·ç«¯ç‹¬ç«‹ï¼‰ |
| æ¡æ‰‹è¿‡ç¨‹ | æ— æ¡æ‰‹ | å®Œæ•´æ¡æ‰‹åè®® |
| ä¸åŒå®¢æˆ·ç«¯é…ç½® | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| æ—§å®¢æˆ·ç«¯å…¼å®¹ | âš ï¸ éœ€è¦ä¿®æ”¹ | âœ… è‡ªåŠ¨å…¼å®¹ |

## API å˜æ›´

### æœåŠ¡ç«¯ API å˜æ›´

#### ç§»é™¤

âŒ å·²ç§»é™¤ `ENABLE_COMPRESSION` å…¨å±€é…ç½®å˜é‡

```python
# v1.0 (å·²ç§»é™¤)
ENABLE_COMPRESSION = True  # ä¸å†ä½¿ç”¨
```

#### æ–°å¢

âœ… æ–°å¢ `connection_config` å­—å…¸

```python
# v2.0 (æ–°å¢)
connection_config: Dict[str, dict] = {}  # ä¸ºæ¯ä¸ªè¿æ¥å­˜å‚¨é…ç½®
# æ ¼å¼: {player_uuid: {"enable_compression": bool}}
```

### WebSocket æ¶ˆæ¯æ ¼å¼å˜æ›´

#### æ¡æ‰‹æ¶ˆæ¯ï¼ˆæ–°å¢ï¼‰

**å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯**:

```json
{
  "type": "handshake",
  "submitPlayerId": "player-id",
  "enableCompression": true/false
}
```

**æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯**:

```json
{
  "type": "handshake_ack",
  "ready": true,
  "compressionEnabled": true/false
}
```

#### æ•°æ®æ¶ˆæ¯æ ¼å¼ï¼ˆä¿æŒä¸å˜ï¼‰

```
[0x00 or 0x01] + [JSON æˆ– gzipæ•°æ®]

- 0x00: æœªå‹ç¼©
- 0x01: gzip å‹ç¼©
```

### å®¢æˆ·ç«¯ API å˜æ›´

#### Python å®¢æˆ·ç«¯

**v1.0**:
```python
client = CompressedWebSocketClient('ws://...', 'player-1')
```

**v2.0**:
```python
# ç¬¬3ä¸ªå‚æ•°æ§åˆ¶æ˜¯å¦å¯ç”¨å‹ç¼©
client = CompressedWebSocketClient(
    'ws://...',
    'player-1',
    enable_compression=True  # æ–°å‚æ•°
)
```

#### JavaScript å®¢æˆ·ç«¯

**v1.0**:
```javascript
const client = new CompressedWebSocketClient('ws://...', 'player-1');
```

**v2.0**:
```javascript
// ç¬¬3ä¸ªå‚æ•°æ§åˆ¶æ˜¯å¦å¯ç”¨å‹ç¼©
const client = new CompressedWebSocketClient(
    'ws://...',
    'player-1',
    true  // æ–°å‚æ•°ï¼Œtrue=å¯ç”¨å‹ç¼©ï¼Œfalse=ç¦ç”¨
);
```

## åŠŸèƒ½å˜æ›´

### æ–°åŠŸèƒ½

âœ¨ **æ¡æ‰‹åè®®**
- å®¢æˆ·ç«¯åœ¨è¿æ¥æ—¶å£°æ˜å‹ç¼©åå¥½
- æœåŠ¡ç«¯è®°å½•å’Œç¡®è®¤æ¯ä¸ªå®¢æˆ·ç«¯çš„é…ç½®
- çµæ´»çš„æŒ‰å®¢æˆ·ç«¯å‹ç¼©æ§åˆ¶

âœ¨ **å¤šæ ·åŒ–é…ç½®**
- åŒä¸€æœåŠ¡å™¨æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ä¸åŒçš„å‹ç¼©è®¾ç½®
- æ¯ä¸ªå®¢æˆ·ç«¯çš„é…ç½®ç‹¬ç«‹å­˜å‚¨
- æ— éœ€æ›´æ–°æœåŠ¡ç«¯å°±èƒ½æ”¹å˜å‹ç¼©é…ç½®ï¼ˆé€šè¿‡å®¢æˆ·ç«¯å‚æ•°ï¼‰

âœ¨ **å‘åå…¼å®¹**
- æ—§å®¢æˆ·ç«¯ï¼ˆä¸å‘æ¡æ‰‹æ¶ˆæ¯ï¼‰è‡ªåŠ¨è§†ä¸ºç¦ç”¨å‹ç¼©
- å¯ä¸æ—§å®¢æˆ·ç«¯æ··ç”¨

### ç§»é™¤åŠŸèƒ½

âŒ **å…¨å±€å‹ç¼©å¼€å…³**
- ä¸å†éœ€è¦ `ENABLE_COMPRESSION` ç¯å¢ƒå˜é‡
- ä¸å†éœ€è¦é‡å¯æœåŠ¡å™¨æ”¹å˜å‹ç¼©è®¾ç½®

## è¿ç§»æŒ‡å—

### æœåŠ¡ç«¯è¿ç§»

1. **æ›´æ–°ä»£ç **
   - ä½¿ç”¨æ–°ç‰ˆæœ¬çš„ `player_esp_server.py`
   - æ— éœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆ`ENABLE_COMPRESSION` å·²ç§»é™¤ï¼‰

2. **é‡å¯æœåŠ¡**
   ```bash
   python player_esp_server.py
   ```

### å®¢æˆ·ç«¯è¿ç§»

#### Python å®¢æˆ·ç«¯

**æ—§ä»£ç **:
```python
from client_example import CompressedWebSocketClient

client = CompressedWebSocketClient('ws://localhost:8765/playeresp', 'player-1')
await client.connect()
```

**æ–°ä»£ç **:
```python
from client_example import CompressedWebSocketClient

# æŒ‡å®š enable_compression å‚æ•°
client = CompressedWebSocketClient(
    'ws://localhost:8765/playeresp',
    'player-1',
    enable_compression=True  # æ”¹ä¸º False ä»¥ç¦ç”¨å‹ç¼©
)
await client.connect()
```

#### JavaScript å®¢æˆ·ç«¯

**æ—§ä»£ç **:
```javascript
const client = new CompressedWebSocketClient('ws://...', 'player-1');
client.connect();
```

**æ–°ä»£ç **:
```javascript
// æŒ‡å®šç¬¬3ä¸ªå‚æ•°
const client = new CompressedWebSocketClient(
    'ws://...',
    'player-1',
    true  // æ”¹ä¸º false ä»¥ç¦ç”¨å‹ç¼©
);
client.connect();
```

#### Minecraft æ¨¡ç»„

éœ€è¦åœ¨æ¡æ‰‹æ—¶å‘é€æ¶ˆæ¯ï¼š

```json
{
  "type": "handshake",
  "submitPlayerId": "player-uuid",
  "enableCompression": true/false
}
```

ç¡®ä¿åœ¨å‘é€å…¶ä»–æ¶ˆæ¯å‰ç­‰å¾…æ¡æ‰‹ç¡®è®¤ã€‚

## æ€§èƒ½å¯¹æ¯”

### å†…å­˜å ç”¨

| ç‰ˆæœ¬ | å˜åŒ– | åŸå›  |
|------|------|------|
| v1.0 | - | åŸºå‡† |
| v2.0 | +5% å¢åŠ  | å­˜å‚¨æ¯ä¸ªè¿æ¥çš„é…ç½® |

**å½±å“**: å¾®ä¹å…¶å¾®ï¼ˆæ¯ä¸ªè¿æ¥é…ç½® < 100 bytesï¼‰

### CPU å ç”¨

**æ— å˜åŒ–** - å‹ç¼©ç®—æ³•å’Œé€»è¾‘ç›¸åŒ

### ç½‘ç»œå¸¦å®½

**æ— å˜åŒ–** - ä»ç„¶æ”¯æŒ 70-85% çš„å¸¦å®½èŠ‚çœï¼ˆä¸ v1.0 ç›¸åŒï¼‰

## å·²çŸ¥é—®é¢˜

### å…¼å®¹æ€§

âš ï¸ **v2.0 æœåŠ¡ç«¯ä¸ v1.0 å®¢æˆ·ç«¯çš„å…¼å®¹æ€§**:

- æ—§å®¢æˆ·ç«¯ï¼ˆv1.0ï¼‰ç›´æ¥å‘é€æ•°æ®ï¼ˆä¸æ¡æ‰‹ï¼‰
- æœåŠ¡ç«¯è‡ªåŠ¨ä½œä¸ºæœªå‹ç¼©å¤„ç†
- âœ… å¯ä»¥æ­£å¸¸å·¥ä½œ

### æ•…éšœæ’æŸ¥

**é—®é¢˜**: å®¢æˆ·ç«¯è¿æ¥åæ²¡æœ‰æ”¶åˆ°æ¡æ‰‹ç¡®è®¤

**è§£å†³**:
1. ç¡®è®¤å®¢æˆ·ç«¯å·²æ›´æ–°åˆ° v2.0
2. ç¡®è®¤æ¡æ‰‹æ¶ˆæ¯æ ¼å¼æ­£ç¡®
3. æ£€æŸ¥æœåŠ¡ç«¯æ—¥å¿—

## æ–‡ä»¶å˜æ›´æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶

- âœï¸ `player_esp_server.py` - å®ç°æ¡æ‰‹åè®®ï¼Œç§»é™¤å…¨å±€é…ç½®
- âœï¸ `client_example.py` - æ·»åŠ æ¡æ‰‹é€»è¾‘ï¼Œæ–°å¢ enable_compression å‚æ•°
- âœï¸ `client_example.js` - æ·»åŠ æ¡æ‰‹é€»è¾‘ï¼Œæ–°å¢ enableCompression å‚æ•°
- âœï¸ `static/index.html` - æ·»åŠ æ¡æ‰‹é€»è¾‘

### æ–°å¢çš„æ–‡ä»¶

- â• `HANDSHAKE_PROTOCOL.md` - å®Œæ•´çš„æ¡æ‰‹åè®®æ–‡æ¡£
- â• `UPDATE.md` - æœ¬æ–‡ä»¶

### ä¿æŒä¸å˜çš„æ–‡ä»¶

- ğŸ“„ `requirements.txt` - ä¾èµ–æœªå˜
- ğŸ“„ `README.md` - ä»ç„¶é€‚ç”¨ï¼Œå¯è¡¥å……é˜…è¯»

## å‡çº§æ£€æŸ¥æ¸…å•

åœ¨å‡çº§åˆ° v2.0 æ—¶ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] æœåŠ¡ç«¯å·²æ›´æ–°åˆ°æ–°ç‰ˆæœ¬
- [ ] æ‰€æœ‰å®¢æˆ·ç«¯å·²æ›´æ–°ï¼ˆæˆ–ç¡®è®¤å‘åå…¼å®¹ï¼‰
- [ ] æ¡æ‰‹æ¶ˆæ¯æ ¼å¼æ­£ç¡®
- [ ] æµ‹è¯•å‹ç¼©å’Œæœªå‹ç¼©ä¸¤ç§æ¨¡å¼
- [ ] æ£€æŸ¥æœåŠ¡ç«¯æ—¥å¿—ä¸­çš„è¿æ¥ä¿¡æ¯
- [ ] éªŒè¯æ‰‹åŠ¨å’Œè‡ªåŠ¨æ¡æ‰‹ä¸¤ç§æ–¹å¼

## æµ‹è¯•æ–¹æ³•

### æœåŠ¡ç«¯æµ‹è¯•

```bash
# å¯åŠ¨æœåŠ¡
python player_esp_server.py

# æ£€æŸ¥æ—¥å¿—è¾“å‡º
# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# "Client player-1 connected (compression: å¯ç”¨)"
# "Client player-2 connected (compression: ç¦ç”¨)"
```

### å®¢æˆ·ç«¯æµ‹è¯•

**Python**:
```python
# æµ‹è¯•å¯ç”¨å‹ç¼©
client1 = CompressedWebSocketClient('ws://localhost:8765/playeresp', 'p1', True)
await client1.connect()

# æµ‹è¯•ç¦ç”¨å‹ç¼©
client2 = CompressedWebSocketClient('ws://localhost:8765/playeresp', 'p2', False)
await client2.connect()
```

**JavaScript**:
```javascript
// æµ‹è¯•å¯ç”¨å‹ç¼©
const c1 = new CompressedWebSocketClient('ws://...', 'p1', true);
c1.connect();

// æµ‹è¯•ç¦ç”¨å‹ç¼©
const c2 = new CompressedWebSocketClient('ws://...', 'p2', false);
c2.connect();
```

## å¸¸è§é—®é¢˜

**Q: æˆ‘éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç å—ï¼Ÿ**

A: 
- å¦‚æœæ˜¯**æœåŠ¡ç«¯**: ç›´æ¥æ›¿æ¢ `player_esp_server.py`ï¼Œæ— éœ€ä¿®æ”¹å…¶ä»–ä»£ç 
- å¦‚æœæ˜¯**å®¢æˆ·ç«¯**: å»ºè®®æ·»åŠ  `enableCompression` å‚æ•°ä»¥å¯ç”¨æ–°åŠŸèƒ½

**Q: æ—§å®¢æˆ·ç«¯è¿˜èƒ½ç”¨å—ï¼Ÿ**

A: æ˜¯çš„ã€‚æ—§å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨ä½œä¸ºç¦ç”¨å‹ç¼©å¤„ç†ï¼Œå®Œå…¨å…¼å®¹ã€‚

**Q: å¦‚ä½•ç›‘æ§å“ªäº›å®¢æˆ·ç«¯å¯ç”¨äº†å‹ç¼©ï¼Ÿ**

A: æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—ï¼š
```
Client player-1 connected (compression: å¯ç”¨)
Client player-2 connected (compression: ç¦ç”¨)
```

**Q: è¿æ¥åå¯ä»¥æ”¹å˜å‹ç¼©è®¾ç½®å—ï¼Ÿ**

A: ä¸æ”¯æŒã€‚éœ€è¦æ–­å¼€å¹¶é‡æ–°æ¡æ‰‹ã€‚

## è”ç³»æ”¯æŒ

- ğŸ› Bug æŠ¥å‘Š
- ğŸ’¡ åŠŸèƒ½å»ºè®®
- â“ æŠ€æœ¯é—®é¢˜

è¯·æŸ¥çœ‹ [README.md](README.md) ä¸­çš„æ”¯æŒè”ç³»æ–¹å¼ã€‚

## ç‰ˆæœ¬å†å²

### v2.0 (2026-02-15)
- âœ¨ æ–°å¢æ¡æ‰‹åè®®
- âœ¨ å®¢æˆ·ç«¯å†³å®šå‹ç¼©é…ç½®
- âœ¨ æ”¯æŒæ··åˆå‹ç¼©/æœªå‹ç¼©å®¢æˆ·ç«¯
- ğŸ“– æ–°å¢æ¡æ‰‹åè®®æ–‡æ¡£

### v1.0 (åˆå§‹ç‰ˆæœ¬)
- âœ¨ gzip å‹ç¼©æ”¯æŒ
- âœ¨ æœåŠ¡ç«¯å…¨å±€é…ç½®
- âœ¨ åŸºç¡€å®¢æˆ·ç«¯ç¤ºä¾‹

---

**æ„Ÿè°¢ä½¿ç”¨ï¼** æœ‰é—®é¢˜å‰è¯·æŸ¥çœ‹ [HANDSHAKE_PROTOCOL.md](HANDSHAKE_PROTOCOL.md) æ–‡æ¡£ã€‚
